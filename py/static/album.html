<!doctype html>
<html lang="en">
    <head>
        <link rel="stylesheet" type="text/css" href="/semantic-ui/semantic.min.css">
        <script src="/jquery/jquery.min.js"></script>
        <script src="/jquery/sha1.js"></script>
        <script src="/semantic-ui/semantic.min.js"></script>
        <meta charset="UTF-8">
        <title>Available Restaurant</title>
		
		<style type="text/css">
			body {
				background-color: #FFFFFF;
			}
			body > .grid {
				height: 100%;
			}
			.restaurantcolumn {
				max-width: 1000px;
				background-color: #FFFFFF;
			}
		</style>

    </head>
	
	
    <body>
	
	<div class="ui middle aligned center aligned grid">
		<div class="column restaurantcolumn">
			<h2 class="ui violet header">
			<i class="music icon"></i>
			<div class="content" id="albumName">
				
			</div>
            </h2>
            
            <p>
            <div class="content" id="albumDate">
                
            </div>    
            </p>
            
            <table class="ui selectable celled table raised segment center aligned" id="tracktable">
                    <thead>
                      <tr><th>Track Name</th>
                      <th>Artist</th>
                      <th>Duration</th>
                      <th>Rating</th>
                    </tr></thead>
                    <tbody>
            </table>

            <div class="ui negative message hidden"></div>
        </div>
    </div>


	</body>
	
	<script>
		$(document)
			.ready(function(){


                $.ajax({
        				type: 'get',
						url: '/api/getAlbum/',
						data: {
                            id: '731bZzgCiyc5rCtDQ3PiZA'
                        },
						success: function(data) {
							if(data.status=="error") {
                                $('.ui .message').text(data.error);
								$('.ui .message').removeClass("hidden");
								$('.ui .likebutton').removeClass("loading");
                                $('.ui .likebutton').removeClass("disabled");
                            }
							if(data.status=="success"){
                                data.tracks;
                                //console.log(data);
                                jQuery.each(data.tracks, function(i, row) {
                                    $("#albumName").text("Album-"+data.title);
                                    $("#albumDate").text("Released on "+data.time);
                                    $("#tracktable").append("<tr><td>" + row.title + "</td><td>"
                                    + row.artist + "</td><td>" + parseInt(row.duration / 60000) + ':' + parseInt(row.duration % 60000 / 1000)
                                    + "</td>"   
                                    +"<td><form class=\"ui form ratingForm\"><div class=\"ui star rating\" name=\"rate\" data-rating = \""+row.rating+"\""
                                    +"></div><input type=\"hidden\" name=\"trackID\" value=\""+row.tid+"\"></form></td>"
                                    +"</tr>");

                                      
                                    $('.ui .ratingForm').form();
                                    
                                    $('.ui.rating').rating({
                                        maxRating: 5,
                                        onRate: function (rating) {
                                            var myform = $('.ui .ratingForm');
                                            $.ajax({
                                                type: 'post',
                                                url: '/api/insert_update_rating/',
                                                data: myform.serialize(),
                                                success: function(data) {
                                                    if(data.status=="error") {
                                                    console.log(data);
                                
                                                    }
                                                    if(data.status=="success"){
                                                        console.log(data);
                                                    }
                                                },
                                            }); //ajax ends

                                       
                                            
                                            
                                            
                                        }
                                    });
                                
                                    
                                });
							}
						}
                });


                

            });
	</script>
</html>