<!doctype html>
<html lang="en">
    <head>
        <link rel="stylesheet" type="text/css" href="/semantic-ui/semantic.min.css">
        <script src="/jquery/jquery.min.js"></script>
        <script src="/jquery/sha1.js"></script>
        <script src="/semantic-ui/semantic.min.js"></script>
        <meta charset="UTF-8">
        <title>Available Restaurant</title>
		
		<style type="text/css">
			body {
				background-color: #FFFFFF;
			}
			body > .grid {
				height: 100%;
			}
			.restaurantcolumn {
				max-width: 1000px;
				background-color: #FFFFFF;
			}
		</style>

    </head>
	
	
    <body>
	
	<div class="ui middle aligned center aligned grid">
		<div class="column restaurantcolumn">
			<h2 class="ui violet header">
			<i class="music icon"></i>
			<div class="content">
				Album
			</div>
            </h2>
            
            <table class="ui selectable celled table raised segment center aligned" id="tracktable">
                    <thead>
                      <tr><th>Track Name</th>
                      <th>Artist</th>
                      <th>Duration</th>
                      <th>Like</th>
                    </tr></thead>
                    <tbody>
            </table>

            <div class="ui negative message hidden"></div>
        </div>
    </div>


	</body>
	
	<script>
		$(document)
			.ready(function() {
                $.ajax({
        				type: 'get',
						url: '/api/getAlbum/',
						data: {
                            id: '4KWxhQCivZfyTZUISFKLeT'
                        },
						success: function(data) {
							if(data.status=="error") {
                                $('.ui .message').text(data.error);
								$('.ui .message').removeClass("hidden");
								$('.ui .likebutton').removeClass("loading");
                                $('.ui .likebutton').removeClass("disabled");
                            }
							if(data.status=="success"){
                                data.tracks;
                                jQuery.each(data.tracks, function(i, row) {
                                    // console.log(data);
                                    $("#tracktable").append("<tr><td>" + row.title + "</td><td>"
                                    + row.artist + "</td><td>" + parseInt(row.duration / 60000) + ':' + parseInt(row.duration % 60000 / 1000)
                                    + "</td><td><button class='ui violet button likebutton' value=" + row.tid
                                    + ">Like</button></td></tr>");
                                });
							}
						}
                });

                $(".likebutton").click(function() {
                    $('.ui .message').addClass("hidden");
                    $(".likebutton").addClass("disabled");
                    $(this).addClass("loading");
                    $.ajax({
        				type: 'post',
						url: 'insert.php',
						data: {
                            userid: userid,
                            rsvptime: rsvptime,
                            numguests: numguests,
                            rid: $(this).val()
                        },
						success: function(data) {
							if(data.status=="error") {
                                $('.ui .message').text(data.error);
								$('.ui .message').removeClass("hidden");
								$('.ui .likebutton').removeClass("loading");
                                $('.ui .likebutton').removeClass("disabled");
                            }
							if(data.status=="success"){
                                $.ajax({
                                    type: 'post',
						            url: 'booking.php',
                                    data: {
                                        userid: userid
                                    },
                                    success: function(data) {
                                        if(data.status=="error") {
                                            $('.ui .message').text(data.error);
								            $('.ui .message').removeClass("hidden");
								            $('.ui .likebutton').removeClass("loading");
                                            $('.ui .likebutton').removeClass("disabled");
                                        }
                                        else{
                                            sessionStorage.setItem('booking', JSON.stringify(data.result));
                                            window.location.href = "booking.html";
                                        }
                                    }
                                });
							}
						},
					});
                });


            });
	</script>
</html>