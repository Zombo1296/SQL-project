<!doctype html>
<html lang="en">
  
  <head>
    <link rel="stylesheet" type="text/css" href="/semantic-ui/semantic.min.css">
    <script src="/jquery/jquery.min.js"></script>
    <script src="/jquery/sha1.js"></script>
    <script src="/semantic-ui/semantic.min.js"></script>
    <meta charset="UTF-8">
    <title>Me</title>
    <style type="text/css">body { background-color: #FFFFFF; } body > .grid { top: 50%; } .trackcolumn { max-width: 800px; background-color: #FFFFFF; }</style></head>
  
  <body>
    <div class="ui middle aligned center aligned column grid">
      <div class="row"></div>
      <div class="row"></div>
      <div class="eight wide column segment">
        <div class="ui fluid category search">
          <div class="ui icon input">
            <input class="prompt" type="text" placeholder="Search anything...">
            <i class="search icon"></i>
          </div>
          <div class="results"></div>
        </div>
      </div>
      <div class="row">
        <div class="ui three wide column">
            <div class="ui card">
                <div class="image">
                  <img src="/image/avatar/avatar.png"></div>
                <div class="content">
                  <a class="header" id="username">Kristy</a>
                  <div class="meta">
                    <span class="description" id="nickname">Joined in 2017</span></div>
                  <div class="description" id="city">Living in New York.</div></div>
                  <div class="extra content">
                      <a>
                        <i class="user icon"></i><i id="followers">22 Followers</i></a>
                    </div>
              </div>
        </div>
        <div class="fifteen wide column trackcolumn">
          <h3 class="ui violet header">
            <i class="music icon"></i>
            <div class="content">New tracks of my favorite artists</div></h3>
          <table class="ui selectable celled compact table raised segment center aligned" id="tracktable">
            <thead>
              <tr>
                <th>Track Name</th>
                <th>Artist</th>
                <th>Duration</th>
                <th>detail</th></tr>
            </thead>
            <tbody></table>
          <div class="ui negative message hidden"></div>
        </div>
      </div>
      <div class="row">
        <div class="five wide column trackcolumn">
          <h3 class="ui violet header">
            <i class="music icon"></i>
            <div class="content">Playlists I created</div></h3>
          <table class="ui selectable celled compact table raised segment center aligned" id="myplaylists">
            <thead>
              <tr>
                <th>Playlist Name</th>
                <th>Created on</th>
                <th>Play Times</th>
                <th>Detail</th></tr>
            </thead>
            <tbody></table>
          <div class="ui negative message hidden"></div>
        </div>
        <div class="five wide column trackcolumn">
          <h3 class="ui violet header">
            <i class="music icon"></i>
            <div class="content">Playlists my friends created</div></h3>
          <table class="ui selectable celled compact table raised segment center aligned" id="relatedplaylists">
            <thead>
              <tr>
                <th>Playlist Name</th>
                <th>Created on</th>
                <th>Play Times</th>
                <th>Created by</th>
                <th>Detail</th></tr>
            </thead>
            <tbody></table>
          <div class="ui negative message hidden"></div>
        </div>
      </div>
    </div>
  </body>
  <script>$(document).ready(function() {
      $.ajax({
        type: 'get',
        url: '/api/getnewtracks/',
        data: {},
        success: function(data) {
          if (data.status == "error") {
            $('.ui .message').text(data.error);
            $('.ui .message').removeClass("hidden");
            $('.ui .detailbutton').removeClass("loading");
            $('.ui .detailbutton').removeClass("disabled");
          }
          if (data.status == "success") {
            jQuery.each(data.tracks,
            function(i, row) {
              // console.log(data);
              $("#tracktable").append("<tr><td>" + row.title + "</td><td>" + row.artist + "</td><td>" + parseInt(row.duration / 60000) + ':' + parseInt(row.duration % 60000 / 1000) + "</td><td><button class='ui violet button playlistbutton' value=" + row.tid + ">Detail</button></td></tr>");
            });
          }
        }
      });
      $.ajax({
        type: 'get',
        url: '/api/getmyrelatedplaylists/',
        data: {},
        success: function(data) {
          if (data.status == "error") {
            $('.ui .message').text(data.error);
            $('.ui .message').removeClass("hidden");
            $('.ui .detailbutton').removeClass("loading");
            $('.ui .detailbutton').removeClass("disabled");
          }
          if (data.status == "success") {
            jQuery.each(data.playlists,
            function(i, row) {
              // console.log(data);
              $("#relatedplaylists").append("<tr><td>" + row.title + "</td><td>" + row.time + "</td><td>" + row.count + "</td><td>" + row.uname + "</td><td><button class='ui violet button playlistbutton' value=" + row.plid + ">Detail</button></td></tr>");
            });
          }
        }
      });
      $.ajax({
        type: 'get',
        url: '/api/getmyplaylists/',
        data: {},
        success: function(data) {
          if (data.status == "error") {
            $('.ui .message').text(data.error);
            $('.ui .message').removeClass("hidden");
            $('.ui .detailbutton').removeClass("loading");
            $('.ui .detailbutton').removeClass("disabled");
          }
          if (data.status == "success") {
            jQuery.each(data.playlists,
            function(i, row) {
              // console.log(data);
              $("#myplaylists").append("<tr><td>" + row.title + "</td><td>" + row.time + "</td><td>" + row.count + "</td><td><button class='ui violet button playlistbutton' value=" + row.plid + ">Detail</button></td></tr>");
            });
          }
        }
      });
      $.ajax({
        type: 'get',
        url: '/api/getuser/',
        data: {},
        success: function(data) {
          if (data.status == "error") {
          }
          if (data.status == "success") {
            $("#username").text(data.username);
            $("#nickname").text(data.nickname);
            $("#city").val("Living in" + data.city + ".");
            $("#followers").text(data.followers + " followers");
          }
        }
      });
      $(".detailbutton").click(function() {
        $('.ui .message').addClass("hidden");
        $(".detailbutton").addClass("disabled");
        $(this).addClass("loading");
        $.ajax({
          type: 'post',
          url: 'insert.php',
          data: {
            userid: userid,
            rsvptime: rsvptime,
            numguests: numguests,
            rid: $(this).val()
          },
          success: function(data) {
            if (data.status == "error") {
              $('.ui .message').text(data.error);
              $('.ui .message').removeClass("hidden");
              $('.ui .detailbutton').removeClass("loading");
              $('.ui .detailbutton').removeClass("disabled");
            }
            if (data.status == "success") {
              $.ajax({
                type: 'post',
                url: 'booking.php',
                data: {
                  userid: userid
                },
                success: function(data) {
                  if (data.status == "error") {
                    $('.ui .message').text(data.error);
                    $('.ui .message').removeClass("hidden");
                    $('.ui .detailbutton').removeClass("loading");
                    $('.ui .detailbutton').removeClass("disabled");
                  } else {
                    sessionStorage.setItem('booking', JSON.stringify(data.result));
                    window.location.href = "booking.html";
                  }
                }
              });
            }
          },
        });
      });
    });

    $('.ui.search').search({
      type: 'category',
      apiSettings: {
        url: '/api/search/?q={query}'
      },
    });</script>

</html>